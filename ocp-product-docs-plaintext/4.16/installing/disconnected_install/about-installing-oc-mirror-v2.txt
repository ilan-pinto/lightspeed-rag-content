# Mirroring images for a disconnected installation using the version 2



[IMPORTANT]
----
oc-mirror version 2 is a Technology Preview feature only. Technology Preview features are not supported with Red Hat production service level agreements (SLAs) and might not be functionally complete. Red Hat does not recommend using them in production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process.
For more information about the support scope of Red Hat Technology Preview features, see Technology Preview Features Support Scope.
----
Running your cluster in a restricted network without direct internet connectivity is possible by installing the cluster from a mirrored set of Red Hat OpenShift Container Platform container images in a private registry. This registry must be running at all times provided that the cluster is running. See "Prerequisites" section for more information.
You can use the oc-mirror OpenShift CLI (oc) plugin to mirror images to a mirror registry in your fully or partially disconnected environments. You must run oc-mirror from a system with internet connectivity in order to download the required images from the official Red Hat registries.
The following steps outline the high-level workflow on how to use the oc-mirror plugin to mirror images to a mirror registry:
1. Create an image set configuration file.
2. Mirror the image set to the target mirror registry by using one of the following workflows:
* Mirror an image set directly to the target mirror registry (Mirror-to-Mirror).
* Mirror an image set to disk (Mirror-to-Disk), transfer the tar file to the target environment, then mirror the image set to the target mirror registry (Disk-to-Mirror).
3. Configure your cluster to use the resources generated by the oc-mirror.
4. Repeat these steps to update your target mirror registry as necessary.

# About oc-mirror plugin version 2

You can use the oc-mirror OpenShift CLI (oc) plugin as a single tool to mirror all required Red Hat OpenShift Container Platform content and other images to your mirror registry.

To use oc-mirror, add the --v2 flag to the oc-mirror command line. The new tool is is available as a Tech Preview feature.

oc-mirror version 2 (V2) provides the following features:

* Verifies that the complete image set specified in the image set config is mirrored to the mirrored registry, regardless of whether the images were previously mirrored or not.
* Uses a cache system instead of metadata.
* Maintains minimal archive sizes by incorporating only new images into the archive.
* Generate mirroring archives with content selected by mirroring date.
* Can generate IDMS and ITMS (instead of ICSP) for the full image set, rather than just the incremental changes.
* Filter Operator versions by bundle name.
* Does not perform automatic pruning; instead, it introduces a Delete feature, granting users more control over the image deletion.
* Introduces support for registries.conf, facilitating mirroring to multiple enclaves using the same cache.

# oc-mirror V2 compatibility and support

The oc-mirror plugin V2 supports mirroring Red Hat OpenShift Container Platform payload images and Operator catalogs for Red Hat OpenShift Container Platform versions 4.12 and later.


[NOTE]
----
On aarch64, ppc64le, and s390x architectures the oc-mirror plugin is only supported for Red Hat OpenShift Container Platform versions 4.14 and later.
----

Use the latest available version of the oc-mirror plugin regardless of which versions of Red Hat OpenShift Container Platform you need to mirror.

# Prerequisites

* You must have a container image registry that supports Docker V2-2 in the location that will host the Red Hat OpenShift Container Platform cluster, such as Red Hat Quay.

[NOTE]
----
If you use Red Hat Quay, you must use version 3.6 or later with the oc-mirror plugin. If you have an entitlement to Red Hat Quay, see the documentation on deploying Red Hat Quay for proof-of-concept purposes or by using the Red Hat Quay Operator. If you need additional assistance selecting and installing a registry, contact your sales representative or Red Hat Support.
----

If you do not have an existing solution for a container image registry, Red Hat OpenShift Container Platform subscribers receive a mirror registry for Red Hat OpenShift. This mirror registry is included with your subscription and serves as a small-scale container registry that can be used to mirror the necessary container images of Red Hat OpenShift Container Platform for disconnected installations.

* Every machine in the provisioned clusters must have access to the mirror registry. If the registry is unreachable, tasks like installation, updating, or routine operations such as workload relocation may fail. Therefore, mirror registries must be operated in a highly available manner, ensuring their availability aligns with the production availability of your Red Hat OpenShift Container Platform clusters.
* You have set the umask parameter to 0022 on the operating system that uses oc-mirror.